<div component="composer" class="composer resizable reply" cid="{$cid}" style="visibility: visible;">
	<div class="composer-container">
		<nav class="navbar navbar-fixed-top mobile-navbar visible-xs visible-sm">
			<div class="pull-left">
				<a class="btn btn-sm btn-primary composer-discard" style="font-size:20px;" data-action="discard" tabindex="-1" href="{$WEBPATH}/cate/{$cid}"><i class="fa fa-times"></i></a>
			</div>
			<div class="pull-right">
				<button class="btn btn-sm btn-primary composer-submit" data-action="post" tabindex="5"><i class="fa fa-chevron-right"></i></button>
			</div>
			<h4 class="title">发布帖子到 "{$catename}"</h4>
		</nav>
		<div class="row title-container">
		    
			<div class="col-lg-12 col-md-12">
			    
				<span class="title form-control">发布帖子到 "{$catename}"</span>
				
			</div>
			
		</div>
		<div class="category-tag-row">
		    <div class="form-control" style="text-align: center;font-size: 1.4em;display:flex;">
		        <span class="help" style="width: 20%;">标题 <i class="fa fa-fw fa fa-pencil"></i></span>
                <input type="text" style="width: 80%;padding-left: 1em;height: fit-content;" name="title" id="title" value="">
            </div>
			<div class="btn-toolbar formatting-bar">
				<div class="btn-group pull-right action-bar hidden-sm hidden-xs">
					<a class="btn btn-default composer-discard" data-action="discard" tabindex="-1" href="{$WEBPATH}/cate/{$cid}"><i class="fa fa-times"></i> 撤销</a>

					<button class="btn btn-primary composer-submit" data-action="post"><i class="fa fa-check"></i> 提交</button>
				</div>
				
			</div>
		</div>
        <div id="test-editor"></div>
	</div>
</div>
<script type="text/javascript">
    var editor=loadEditor("test-editor");
</script>
<script>
$('[data-action="discard"]').click(function(){//取消
    $('[component="composer"]').css("visibility","hidden");
});
$('[data-action="post"]').click(function(){//发布帖子
    var cid=$('[class="composer resizable reply"]')[0].getAttribute("cid");
    var title=$('#title').val();
    var data={cid:cid,content:editor.getContent(),title:title,'token':{$token}};
    var pushed=false;
    if(layer!=null){
        pushed=true;
        $.ajax({
            url:"{$WEBPATH}/api/bbs/publish",
            method:"POST",
            dataType:"json",
            data:data,
            success:function(res){
                layer.msg(res.msg);
                if(res.code==200){
                    $('[component="composer"]').css("visibility","hidden");
                    window.location.href="/com/cate/{$cid}";
                }
            }
     });
    }else if(pushed){
        alert("你已提交成功，请勿重复提交");
    }else{
        alert("组件未加载成功,请刷新页面重试");
    }
});
$('[class="btn btn-primary waves-effect waves-button"]').click(function(obj){//发布帖子
    $('[component="composer"]').css("visibility","visible");
});
</script>